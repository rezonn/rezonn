<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script>

function newhtml(tag,attributes,ths) {
  var rv = document.createElement(tag);
  for (var x in attributes) {
    if (x!="style") rv[x] = attributes[x];
    else {
      for (var s in attributes[x]) {
        rv.style[s] = attributes[x][s];
      }
    }
  }
  if (ths) ths.appendChild(rv);
  return rv;
}
  
function getAsUriParameters(data) {
   var url = '';
   for (var prop in data) {
      url += encodeURIComponent(prop) + '=' + 
          encodeURIComponent(data[prop]) + '&';
   }
   return url.substring(0, url.length - 1)
}
  
async function upload() {
  //let blob = await (new Promise(resolve => canvas.toBlob(resolve)));
  var url = "https://www.googleapis.com/upload/youtube/v3/videos?"+getAsUriParameters({
    'key':localStorage.getItem("Key"),
    'uploadType':'resumable',
    'part':'snippet, status',
  });
  //var url = "https://www.googleapis.com//upload/youtube/v3/videos?uploadType=resumable&part=snippet,status,contentDetails";
  var url = "https://www.googleapis.com/youtube/v3/videos?part=snippet%2Cstatus&key="+localStorage.getItem("Key");
  newhtml("div",{innerText:url},document.body);
  var data = {
      "snippet": {
          "title": Date.parse(new Date()),
          "description": "home bell video",
          "tags": ["home"],
          "categoryId": 42
      },
      "status": {
          "privacyStatus": "private"
      }
  }

  try {
    const response = await fetch(url, 
    {
      method:'POST',
      headers:{
        'Access-Control-Allow-Origin':'*',
        /*
        'Access-Control-Allow-Methods':'POST, GET, OPTIONS, DELETE, PUT',
        'Access-Control-Max-Age':'1000',
        'Access-Control-Allow-Headers':'x-requested-with, Content-Type, origin, authorization, accept, client-security-token',
        */
        'Accept':'application/json',
        'Authorization':'Bearer '+localStorage.getItem("Authorization"),
        'Content-Type':'application/json'
      },
      body:'{"snippet":{"categoryId":"22","description":"Description","title":"Test video"},"status":{"privacyStatus":"private"}}'
    });
  } catch(e) {
    newhtml("div",{innerText:"fetch error: "+e.message},document.body);
  }
}

window.onload = function(){
  newhtml("div",{innerText:"hello world"},document.body);
  newhtml("div",{innerText:localStorage.getItem("Key")},document.body);
  newhtml("div",{innerText:localStorage.getItem("Authorization")},document.body);
  upload();
}

</script>
<body></body>
